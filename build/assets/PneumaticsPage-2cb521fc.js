import{j as e,Q as R,r,S as E,T as oe,C as H,b as f,U as V,V as P,W as _,M as a,X as re,Y as $,Z as ne,$ as ie,G as ae,N as le,a0 as ce,a1 as w,e as de,__tla as me}from"./index-ed88989a.js";import{G as ue}from"./Graph-b962b43a.js";import{N as pe,S as xe}from"./NumberInput-ab658c02.js";import{a as c,S as fe,u as he}from"./L1ControlledNumber-9a2b012a.js";import{B as ye}from"./BooleanInput-50cc7fcb.js";import{L as je,m as ke,M as g}from"./MeasurementInput-70656c8f.js";import{M as N}from"./MeasurementOutput-fca1a435.js";import{N as B}from"./NumberOutput-1d47cff7.js";import{e as we,w as ge}from"./promise-worker-e6956b4a.js";import{u as be}from"./index-d24790f6.js";import{P as Se}from"./readmes-1eff17f1.js";import"./io-df8bba7d.js";let M,Te=Promise.all([(()=>{try{return me}catch{}})()]).then(async()=>{function q(t){return e.jsx(je,{...ke(t),choices:R.getAllChoices(),makeString:o=>o.identifier,fromString:o=>R.fromIdentifier(o)})}function G(t){const[o,i]=t.stateHook,n=["lowkey-input",t.disabled?"has-text-black":"has-text-white"];return e.jsx("input",{className:n.join(" "),type:"text",placeholder:"Piston Name",defaultValue:o,onBlur:s=>i(s.target.value)})}function O(t){const[o,i]=t.stateHook,n={extendForce:C=>C.getExtendForce(S),retractForce:C=>C.getRetractForce(b)},[s,d]=r.useState(t.piston),[m,x]=r.useState(t.piston.identifier),[u,h]=r.useState(t.piston.quantity),[l,y]=r.useState(t.piston.bore),[p,v]=r.useState(t.piston.rodDiameter),[j,k]=r.useState(t.piston.strokeLength),[b,X]=r.useState(t.piston.retractPressure),[S,Y]=r.useState(t.piston.extendPressure),[T,Z]=r.useState(t.piston.enabled),[D,ee]=r.useState(t.piston.period),[te,L]=r.useState(n.retractForce(s).to("N")),[se,A]=r.useState(n.extendForce(s).to("N"));return r.useEffect(()=>{const C=s,I=new E(m,u,l,p,j,b,S,T,D);d(I),i(o.replaceInSameSpot(C,I))},[m,u,p,j,b,S,T,D]),r.useEffect(()=>{v(E.rodDiameterFromBore(l))},[l]),r.useEffect(()=>{A(n.extendForce(s))},[s,S]),r.useEffect(()=>{L(n.retractForce(s))},[s,b]),e.jsxs(oe,{removeInternalBorders:!0,heading:e.jsxs(H,{multiline:!0,vcentered:!0,marginLess:!0,paddingLess:!0,gapless:!0,children:[e.jsx(f,{ofTwelve:8,children:e.jsx(G,{stateHook:[m,x],disabled:!s.enabled})}),e.jsx(f,{children:e.jsx(V,{color:"primary",faIcon:"minus-circle",inverted:T,onClick:t.removeFn,children:"Remove"})})]}),color:T?"primary":void 0,children:[e.jsxs(H,{multiline:!0,children:[e.jsx(f,{children:e.jsx(c,{label:"Enabled",children:e.jsx(ye,{stateHook:[T,Z]})},`${s.identifier}-enable`)}),e.jsx(f,{children:e.jsx(c,{label:"Count",tooltip:"Number of identical cylinders on the robot.",children:e.jsx(pe,{stateHook:[u,h]})})})]}),e.jsx(c,{label:"Bore",wrap:!0,tooltip:"Outer diameter of the cylinder itself.",children:e.jsx(g,{stateHook:[l,y]})},`${s.identifier}-bore`),e.jsx(c,{wrap:!0,label:"Rod Diameter",tooltip:"Diameter of the piston rod that extends out of the cylinder. Typically based on bore.",children:e.jsx(N,{stateHook:[p,v],numberRoundTo:[.1875,.3125,.4375].includes(p.to("in").scalar)?4:3})},`${s.identifier}-rodDiameter`),e.jsx(c,{wrap:!0,label:"Stroke Length",tooltip:"Length that the piston rod extends out of the cylinder.",children:e.jsx(g,{stateHook:[j,k]})},`${s.identifier}-stroke`),e.jsx(c,{wrap:!0,label:"Retract Pressure",tooltip:"Maximum working pressure for the retraction of the cylinder.",children:e.jsx(g,{stateHook:[b,X]})},`${s.identifier}-retractPressure`),e.jsx(c,{wrap:!0,label:"Extend Pressure",tooltip:"Maximum working pressure for the extension of the cylinder.",children:e.jsx(g,{expanded:!0,stateHook:[S,Y]})},`${s.identifier}-extendPressure`),e.jsx(c,{wrap:!0,label:"Retract Force",tooltip:"Resulting force the cylinder can retract at.",children:e.jsx(N,{expanded:!0,stateHook:[te,L],numberRoundTo:2})},`${s.identifier}-retractForce`),e.jsx(c,{wrap:!0,label:"Extend Force",tooltip:"Resulting force the cylinder can extend at.",children:e.jsx(N,{expanded:!0,stateHook:[se,A],numberRoundTo:2,defaultUnit:"N"})},`${s.identifier}-extendForce`),e.jsx(c,{label:"Toggle State Every",tooltip:"How often this set of cylinders fires in a match.",wrap:!0,children:e.jsx(g,{stateHook:[D,ee]})},`${s.identifier}-period`)]})}class W{static getState(){if(P.version===void 0)throw Error("Config did not set version! "+P.url);return fe.BumpState(P.version,[_],[])}}function F(t,o,i){if(o.scalar===0)return{timeline:[],dutyCycle:0};const n=[{x:0,y:$}],s=new a(2*60+30,"s"),d=new a(1,"s");let m=new a(0,"s"),x=new a(0,"s"),u=!1;const h=t.pistons.map(l=>l.period.copy());for(;m.lt(s);){const l=n[n.length-1].y;let y=new a(0,"J");t.pistons.forEach((j,k)=>{!j.enabled||j.period.eq(new a(0,"s"))||(h[k]=h[k].sub(d),h[k].lt(new a(0,"s"))&&(h[k]=j.period.copy().sub(d),y=y.add(j.toggleStateAndGetWorkFromIt(l))))}),u&&l.gte($)?u=!1:!u&&l.lte(re)&&(u=!0),u&&(x=x.add(d));const p=(u?i.getWork(l,d):new a(0,"J")).sub(y).div(o),v=l.add(p);n.push({x:m.to("s").scalar,y:v.clamp(new a(0,"psi"),$)}),m=m.add(d)}return{timeline:n.map(({x:l,y})=>({x:l,y:y.to("psi").scalar})),dutyCycle:x.div(s).scalar*100}}function J(t,o){const i=ne.fromDict(t),n=R.fromDict(o),s=574;let d=s;for(;;)if(F(i,new a(d,"ml"),n).timeline.reduce((m,x)=>m.y<x.y?m:x).y<20)d+=s;else return d/s}we({generatePressureTimeline:F,getRecommendedTanks:J});function U(){return new Worker("/assets/math-5c677c56.js")}const z=await ge(new U),K=t=>{const o=Math.max(...t.pistons.map(n=>ce(n.identifier))),i=[-1/0,1/0,NaN].includes(o)?1:o+1;return new E(`Piston ${i}`,1,new a(w(1,6)/2,"in"),new a(w(1,12)/16,"in"),new a(w(1,12),"in"),new a(w(15,60),"psi"),new a(w(15,60),"psi"),!0,new a(w(4,16),"s"))};function Q(){const[t,o]=he(W.getState()),i={timelineAndDutyCycle:()=>F(t.pistons,t.tankVolume,t.compressor),timeline:()=>n.timeline,dutyCycle:()=>n.dutyCycle,recommendedTanks:()=>z.getRecommendedTanks(t.pistons.toDict(),t.compressor.toDict())},[n,s]=r.useState(i.timelineAndDutyCycle()),[d,m]=r.useState(i.timeline()),[x,u]=r.useState(i.dutyCycle()),[h,l,y]=be(i.recommendedTanks,[t.pistons.pistons,t.compressor]);return r.useEffect(()=>{s(i.timelineAndDutyCycle())},[t.pistons,t.tankVolume,t.compressor]),r.useEffect(()=>{m(i.timeline()),u(i.dutyCycle())},[n]),e.jsxs(e.Fragment,{children:[e.jsx(xe,{queryParams:_,state:t,title:"Pneumatics Calculator"}),e.jsx(ue,{options:ie,simpleDatasets:[ae.dataset("System Pressure (psi)",d,0,"y")],title:"System Pressure Over Time",id:"pneumaticsGraph"}),e.jsxs(H,{multiline:!0,centered:!0,children:[e.jsx(f,{narrow:!0,children:e.jsx(V,{color:"primary",onClick:()=>{o.setPistons(t.pistons.copyAndAdd(K(t.pistons)))},faIcon:"plus",children:"Add Cylinder"})}),e.jsx(f,{children:e.jsx(c,{label:"Tank Volume",id:"tankVolumeInput",tooltip:"The total volume of pneumatic tanks on the robot. The most common size is 574mL.",children:e.jsx(g,{stateHook:[t.tankVolume,o.setTankVolume]})})}),e.jsx(f,{narrow:!0,children:e.jsx(c,{label:"Compressor",id:"compressor",tooltip:"The compressor powering the system.",children:e.jsx(q,{stateHook:[t.compressor,o.setCompressor]})})}),e.jsx(f,{narrow:!0,children:e.jsx(c,{label:"Compressor Duty Cycle (%)",id:"dutyCycleOutput",tooltip:"How often the compressor is running during a match.",children:e.jsx(B,{stateHook:[x,u],roundTo:2})})}),e.jsx(f,{narrow:!0,children:e.jsx(c,{label:"Recommended KOP Tanks",id:"recommendedTanks",tooltip:"The number of 574mL tanks required to not drop below 20psi during a match.",children:e.jsx(B,{stateHook:[h||0,le],loadingIf:()=>[0,void 0].includes(h),roundTo:0})})})]}),e.jsx(H,{multiline:!0,centered:!0,children:t.pistons.pistons.map(p=>e.jsx(f,{ofTwelve:4,children:e.jsx(O,{piston:p,name:p.identifier,removeFn:()=>o.setPistons(t.pistons.copyAndRemove(p)),stateHook:[t.pistons,o.setPistons]})},`Column-${p.identifier}`))})]})}M=function(){return e.jsxs(e.Fragment,{children:[e.jsx(de,{pageConfig:P}),e.jsx(Q,{}),e.jsx(Se,{})]})}});export{Te as __tla,M as default};
